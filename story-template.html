<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{storyteller_name}}'s Story - Stories of You</title>
  <meta name="description" content="Listen to {{storyteller_name}}'s story about {{prompt}}" />
  <link rel="icon" href="/favicon.ico" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="{{storyteller_name}}'s Story" />
  <meta property="og:description" content="Listen to a personal story about {{prompt}}" />
  <meta property="og:image" content="/og-image.jpg" />
  <meta property="og:url" content="https://storiesofyou.ai/story/{{story_id}}" />
  <meta name="twitter:card" content="summary_large_image" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --brand-navy:#0f2c4c;
      --brand-orange:#e09a1b;
      --brand-charcoal:#3d3528;
      --warm-light:#faf3e7;
      --warm-mid:#e0cba7;
    }
    .bg-warm-light{background-color:var(--warm-light)}
    .bg-warm-mid{background-color:var(--warm-mid)}
    .story-container{
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,.1);
      overflow: hidden;
    }
    .audio-player {
      width: 100%;
      margin: 20px 0;
    }
    .audio-player audio {
      width: 100%;
      height: 60px;
      border-radius: 8px;
    }
    .transcript-text {
      line-height: 1.8;
      font-size: 1.1rem;
      color: #374151;
    }
    .prompt-display {
      background: linear-gradient(135deg, var(--brand-navy), #1e40af);
      color: white;
      padding: 2rem;
      text-align: center;
    }
    .btn-primary{
      background-color:var(--brand-charcoal);
      color:#fff;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .btn-primary:hover{
      background-color:#5a4d3a;
      transform: translateY(-2px);
    }
    .story-meta {
      color: #6b7280;
      font-size: 0.9rem;
    }
    .loading-state {
      background: var(--warm-light);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      color: var(--brand-charcoal);
    }
  </style>
</head>
<body class="bg-warm-light min-h-screen">

  <!-- Header -->
  <header class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <a href="/">
        <img src="/logo.png" alt="Stories of You" class="h-8 w-auto" />
      </a>
      <nav class="hidden md:flex items-center space-x-6">
        <a href="/" class="text-sm text-gray-600 hover:text-gray-900 transition-colors">Home</a>
        <a href="/about.html" class="text-sm text-gray-600 hover:text-gray-900 transition-colors">About</a>
        <a href="/" class="btn-primary text-sm">Record Your Story</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="py-12 px-6">
    <div class="story-container">
      
      <!-- Prompt Display -->
      <div class="prompt-display">
        <h1 class="text-2xl md:text-3xl font-bold mb-2">{{storyteller_name}}'s Story</h1>
        <p class="text-xl opacity-90">"{{prompt}}"</p>
      </div>

      <!-- Story Content -->
      <div class="p-8">
        
        <!-- Audio Player Section -->
        <div class="mb-8">
          <h2 class="text-xl font-semibold mb-4" style="color:var(--brand-navy)">üéµ Listen to the Story</h2>
          <div class="audio-player">
            <audio controls preload="metadata">
              <source src="{{audio_url}}" type="audio/mpeg">
              <source src="{{audio_url}}" type="audio/webm">
              <source src="{{audio_url}}" type="audio/mp4">
              Your browser does not support the audio element.
            </audio>
          </div>
          <p class="story-meta mt-2">
            üìÖ Recorded on {{recording_date}} ‚Ä¢ ‚è±Ô∏è Duration: {{duration}}
          </p>
        </div>

        <!-- Transcript Section -->
        <div class="mb-8">
          <h2 class="text-xl font-semibold mb-4" style="color:var(--brand-navy)">üìù Transcript</h2>
          
          <!-- Transcript Content (will be populated by JavaScript) -->
          <div id="transcript-content">
            {{#if transcript}}
              <div class="transcript-text">{{transcript}}</div>
            {{else}}
              <div class="loading-state">
                <div class="animate-pulse">
                  <div class="h-4 bg-gray-300 rounded w-3/4 mb-2"></div>
                  <div class="h-4 bg-gray-300 rounded w-1/2 mb-2"></div>
                  <div class="h-4 bg-gray-300 rounded w-5/6"></div>
                </div>
                <p class="mt-4 text-sm">‚ú® We're preparing your transcript...</p>
                <p class="text-xs mt-1">This usually takes 1-2 minutes</p>
              </div>
            {{/if}}
          </div>
        </div>

        <!-- Story Details -->
        <div class="bg-warm-light p-6 rounded-lg mb-8">
          <h3 class="font-semibold mb-3" style="color:var(--brand-charcoal)">Story Details</h3>
          <div class="grid md:grid-cols-2 gap-4 text-sm story-meta">
            <div>
              <strong>Storyteller:</strong> {{storyteller_name}}
            </div>
            <div>
              <strong>Recording Date:</strong> {{recording_date}}
            </div>
            <div>
              <strong>Story ID:</strong> {{story_id}}
            </div>
            <div>
              <strong>Status:</strong> Beta Version
            </div>
          </div>
        </div>

        <!-- Call to Action -->
        <div class="text-center">
          <h3 class="text-lg font-semibold mb-4" style="color:var(--brand-charcoal)">
            Every story matters. Every voice deserves to be heard.
          </h3>
          <a href="/" class="btn-primary mr-4">Record Another Story</a>
          <a href="/about.html" class="text-gray-600 hover:text-gray-900 text-sm">Learn More About Stories of You</a>
        </div>

      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t border-gray-200 py-8 mt-12">
    <div class="max-w-7xl mx-auto px-6 text-center">
      <div class="flex items-center justify-center gap-3 mb-4">
        <img src="/logo.png" alt="Stories of You" class="h-6 w-auto" />
        <span class="text-sm text-gray-600">Preserving voices for generations</span>
      </div>
      <p class="text-xs text-gray-500">
        ¬© 2025 Stories of You. Beta version - helping families preserve their stories.
      </p>
    </div>
  </footer>

  <script>
    // Auto-refresh transcript if not loaded
    if (!document.querySelector('.transcript-text')) {
      // Check for transcript every 30 seconds
      const checkTranscript = setInterval(async () => {
        try {
          const response = await fetch(`/api/story/{{story_id}}/transcript`);
          if (response.ok) {
            const data = await response.json();
            if (data.transcript) {
              document.getElementById('transcript-content').innerHTML = 
                `<div class="transcript-text">${data.transcript}</div>`;
              clearInterval(checkTranscript);
            }
          }
        } catch (error) {
          console.log('Checking for transcript...');
        }
      }, 30000);

      // Stop checking after 10 minutes
      setTimeout(() => clearInterval(checkTranscript), 600000);
    }

    // Simple analytics (optional)
    if (typeof gtag !== 'undefined') {
      gtag('event', 'story_view', {
        'story_id': '{{story_id}}',
        'storyteller': '{{storyteller_name}}'
      });
    }
  </script>

</body>
</html>